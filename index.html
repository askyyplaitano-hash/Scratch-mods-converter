<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scratch Format Converter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Space+Mono:wght@400;700&display=swap');

  :root {
    --bg: #0e1a2b;
    --surface: #162236;
    --surface2: #1e3050;
    --accent: #4d97ff;
    --accent2: #9966ff;
    --green: #59c059;
    --orange: #ffab19;
    --red: #ff6680;
    --text: #e8f4ff;
    --text-muted: #7a9cc0;
    --border: #2a4060;
    --glow: rgba(77,151,255,0.3);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--border) 1px, transparent 1px),
      linear-gradient(90deg, var(--border) 1px, transparent 1px);
    background-size: 40px 40px;
    opacity: 0.3;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 680px;
    padding: 40px 24px 60px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* Header */
  header { text-align: center; padding: 20px 0 10px; }

  .logo-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    margin-bottom: 10px;
  }

  .logo-box {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 24px var(--glow);
    animation: float 3s ease-in-out infinite;
  }

  .logo-box svg { width: 26px; height: 26px; fill: white; }

  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }

  h1 {
    font-size: 1.9rem;
    font-weight: 900;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle { font-size: 0.9rem; color: var(--text-muted); font-weight: 600; margin-top: 4px; }

  .badge-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 7px;
    margin-top: 14px;
    flex-wrap: wrap;
  }

  .badge {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 3px 9px;
    border-radius: 20px;
    border: 1.5px solid;
  }
  .b-blue   { color: var(--accent);  border-color: var(--accent);  background: rgba(77,151,255,0.1); }
  .b-purple { color: var(--accent2); border-color: var(--accent2); background: rgba(153,102,255,0.1); }
  .b-orange { color: var(--orange);  border-color: var(--orange);  background: rgba(255,171,25,0.1); }
  .b-yellow { color: #ffe066;        border-color: #ffe066;        background: rgba(255,224,102,0.1); }
  .b-teal   { color: #59e09a;        border-color: #59e09a;        background: rgba(89,224,154,0.1); }
  .b-green  { color: var(--green);   border-color: var(--green);   background: rgba(89,192,89,0.1); }

  /* Card */
  .card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 18px;
    padding: 24px;
    transition: border-color 0.2s;
  }
  .card:hover { border-color: rgba(77,151,255,0.4); }

  .card-label {
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .card-label::before {
    content: '';
    width: 3px;
    height: 13px;
    background: linear-gradient(to bottom, var(--accent), var(--accent2));
    border-radius: 2px;
    flex-shrink: 0;
  }

  /* Upload */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 36px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }
  .upload-zone:hover, .upload-zone.drag-over {
    border-color: var(--accent);
    background: rgba(77,151,255,0.04);
  }
  .upload-icon { font-size: 2.4rem; display: block; margin-bottom: 10px; }
  .upload-text { font-size: 0.95rem; font-weight: 700; }
  .upload-sub  { font-size: 0.78rem; color: var(--text-muted); margin-top: 5px; font-weight: 600; }

  .ext-tags {
    display: flex;
    gap: 5px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  .ext-tag {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    padding: 2px 7px;
    border-radius: 5px;
    background: var(--surface2);
    border: 1px solid var(--border);
  }

  /* File selected */
  .file-info {
    display: none;
    align-items: center;
    gap: 12px;
    background: var(--surface2);
    border-radius: 10px;
    padding: 12px 16px;
    margin-top: 12px;
    border: 1px solid var(--border);
  }
  .file-info.visible { display: flex; }

  .file-dot {
    width: 36px;
    height: 36px;
    border-radius: 9px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .file-dot svg { width: 18px; height: 18px; fill: white; }

  .file-details { flex: 1; min-width: 0; }
  .file-name { font-weight: 800; font-size: 0.88rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .file-size { font-size: 0.74rem; color: var(--text-muted); font-family: 'Space Mono', monospace; margin-top: 2px; }

  .file-remove {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 1rem;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s, background 0.15s;
    flex-shrink: 0;
  }
  .file-remove:hover { color: var(--red); background: rgba(255,102,128,0.12); }

  /* Format grid */
  .format-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 7px;
  }

  .fmt-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    padding: 12px 4px;
    background: var(--surface2);
    border: 2px solid var(--border);
    border-radius: 11px;
    cursor: pointer;
    transition: all 0.18s;
    text-align: center;
    user-select: none;
  }
  .fmt-btn:hover { border-color: var(--accent); background: rgba(77,151,255,0.07); }

  .fmt-btn.active[data-format="pmp"]     { border-color:#9966ff; background:rgba(153,102,255,0.1); box-shadow:0 0 12px rgba(153,102,255,0.25); }
  .fmt-btn.active[data-format="snail"]   { border-color:#ffab19; background:rgba(255,171,25,0.09);  box-shadow:0 0 12px rgba(255,171,25,0.2); }
  .fmt-btn.active[data-format="bm"]      { border-color:#ffe066; background:rgba(255,224,102,0.09); box-shadow:0 0 12px rgba(255,224,102,0.2); }
  .fmt-btn.active[data-format="dino"]    { border-color:#59e09a; background:rgba(89,224,154,0.09);  box-shadow:0 0 12px rgba(89,224,154,0.2); }
  .fmt-btn.active[data-format="cw"]      { border-color:#ff9dd6; background:rgba(255,157,214,0.09); box-shadow:0 0 12px rgba(255,157,214,0.2); }
  .fmt-btn.active[data-format="dbp"]     { border-color:#60cfff; background:rgba(96,207,255,0.09);  box-shadow:0 0 12px rgba(96,207,255,0.2); }
  .fmt-btn.active[data-format="electra"] { border-color:#a78bfa; background:rgba(167,139,250,0.09); box-shadow:0 0 12px rgba(167,139,250,0.2); }
  .fmt-btn.active[data-format="coffee"]  { border-color:#c8a46e; background:rgba(200,164,110,0.09); box-shadow:0 0 12px rgba(200,164,110,0.2); }
  .fmt-btn.active[data-format="falcon"]  { border-color:#6ee7b7; background:rgba(110,231,183,0.09); box-shadow:0 0 12px rgba(110,231,183,0.2); }
  .fmt-btn.active[data-format="ich"]     { border-color:#f472b6; background:rgba(244,114,182,0.09); box-shadow:0 0 12px rgba(244,114,182,0.2); }
  .fmt-btn.active[data-format="zinc"]    { border-color:#93c5fd; background:rgba(147,197,253,0.09); box-shadow:0 0 12px rgba(147,197,253,0.2); }
  .fmt-btn.active[data-format="sb3"]     { border-color:#4d97ff; background:rgba(77,151,255,0.09);  box-shadow:0 0 12px rgba(77,151,255,0.2); }

  .fmt-dot {
    width: 28px;
    height: 28px;
    border-radius: 7px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .fmt-dot svg { width: 14px; height: 14px; }

  .fmt-name { font-size: 0.6rem; font-weight: 800; color: var(--text); line-height: 1.2; }
  .fmt-ext  { font-family: 'Space Mono', monospace; font-size: 0.55rem; color: var(--text-muted); }

  @media (max-width: 540px) {
    .format-grid { grid-template-columns: repeat(4, 1fr); }
  }
  @media (max-width: 360px) {
    .format-grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* Convert button */
  .btn-convert {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    font-weight: 900;
    cursor: pointer;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    color: white;
    transition: all 0.18s;
    box-shadow: 0 4px 18px rgba(77,151,255,0.3);
    letter-spacing: 0.2px;
  }
  .btn-convert:disabled { opacity: 0.35; cursor: not-allowed; box-shadow: none; }
  .btn-convert:not(:disabled):hover { transform: translateY(-2px); box-shadow: 0 7px 24px rgba(77,151,255,0.45); }
  .btn-convert:not(:disabled):active { transform: translateY(0); }

  .btn-row { display: flex; gap: 10px; }
  .btn-row .btn-convert { flex: 1; }

  .btn-export-all {
    padding: 16px 20px;
    border: 1.5px solid var(--border);
    border-radius: 12px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    font-weight: 900;
    cursor: pointer;
    background: var(--surface);
    color: var(--text-muted);
    transition: all 0.18s;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .btn-export-all:disabled { opacity: 0.35; cursor: not-allowed; }
  .btn-export-all:not(:disabled):hover {
    border-color: var(--green);
    color: var(--green);
    background: rgba(89,192,89,0.07);
    box-shadow: 0 4px 16px rgba(89,192,89,0.2);
  }

  .same-format-msg {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: rgba(255,171,25,0.08);
    border: 1.5px solid rgba(255,171,25,0.3);
    border-radius: 10px;
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--orange);
  }
  .same-format-msg.visible { display: flex; }

  /* Progress */
  .prog-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--text-muted);
    margin-bottom: 8px;
  }
  .prog-track { height: 7px; background: var(--surface2); border-radius: 10px; overflow: hidden; }
  .prog-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 10px;
    width: 0%;
    transition: width 0.3s ease;
  }

  /* Log */
  .log-box {
    margin-top: 14px;
    background: #080f1a;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px;
    font-family: 'Space Mono', monospace;
    font-size: 0.72rem;
    line-height: 1.75;
    max-height: 150px;
    overflow-y: auto;
  }
  .log-line { display: flex; gap: 8px; }
  .log-t  { color: #3a5878; flex-shrink: 0; }
  .log-ok   { color: var(--green); }
  .log-info { color: var(--accent); }
  .log-err  { color: var(--red); }

  /* Result */
  .result-card {
    display: none;
    flex-direction: column;
    gap: 0;
    animation: popIn 0.35s cubic-bezier(0.34,1.56,0.64,1);
    padding: 0;
    overflow: hidden;
  }
  .result-card.visible { display: flex; }

  @keyframes popIn {
    from { transform: scale(0.92); opacity: 0; }
    to   { transform: scale(1); opacity: 1; }
  }

  .result-top {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px 24px;
  }

  .result-check {
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, var(--green), #3dab3d);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 0 20px rgba(89,192,89,0.35);
  }
  .result-check svg { width: 22px; height: 22px; stroke: white; fill: none; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

  .result-info { flex: 1; min-width: 0; }
  .result-title { font-size: 1rem; font-weight: 900; color: var(--green); }
  .result-file  { font-size: 0.78rem; color: var(--text-muted); font-family: 'Space Mono', monospace; margin-top: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  .result-actions {
    display: flex;
    gap: 10px;
    padding: 0 24px 20px;
  }

  .btn-download {
    flex: 1;
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    font-weight: 800;
    cursor: pointer;
    background: linear-gradient(90deg, var(--green), #3dab3d);
    color: white;
    transition: all 0.18s;
    box-shadow: 0 3px 14px rgba(89,192,89,0.3);
  }
  .btn-download:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(89,192,89,0.45); }

  .btn-again {
    padding: 12px 20px;
    background: none;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    font-weight: 800;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.18s;
    white-space: nowrap;
  }
  .btn-again:hover { border-color: var(--accent); color: var(--accent); }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  footer {
    position: relative;
    z-index: 1;
    text-align: center;
    font-size: 0.72rem;
    color: var(--text-muted);
    font-weight: 600;
    padding-bottom: 30px;
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <h1>Scratch Converter</h1>
    <p class="subtitle">Convert projects between all Scratch forks</p>
  </header>

  <!-- Upload -->
  <div class="card">
    <div class="card-label">Input file</div>
    <input type="file" id="fileInput" accept=".sb3,.pmp,.snail,.bm,.dino,.cw,.dbp,.electra,.coffee,.falcon,.ich,.zinc" style="display:none;">
    <div class="upload-zone" id="uploadZone">
      <span class="upload-icon">üìÅ</span>
      <div class="upload-text">Drop file here or click to browse</div>
      <div class="upload-sub">Supports .sb3 ¬∑ .pmp ¬∑ .snail ¬∑ .bm ¬∑ .dino ¬∑ .cw ¬∑ .dbp ¬∑ .electra ¬∑ .coffee ¬∑ .falcon ¬∑ .ich ¬∑ .zinc</div>
      <div class="ext-tags">
        <span class="ext-tag" style="color:var(--accent);">.sb3</span>
        <span class="ext-tag" style="color:var(--accent2);">.pmp</span>
        <span class="ext-tag" style="color:var(--orange);">.snail</span>
        <span class="ext-tag" style="color:#ffe066;">.bm</span>
        <span class="ext-tag" style="color:#59e09a;">.dino</span>
        <span class="ext-tag" style="color:#ff9dd6;">.cw</span>
        <span class="ext-tag" style="color:#60cfff;">.dbp</span>
        <span class="ext-tag" style="color:#a78bfa;">.electra</span>
        <span class="ext-tag" style="color:#c8a46e;">.coffee</span>
        <span class="ext-tag" style="color:#6ee7b7;">.falcon</span>
        <span class="ext-tag" style="color:#f472b6;">.ich</span>
        <span class="ext-tag" style="color:#93c5fd;">.zinc</span>
      </div>
    </div>
    <div class="file-info" id="fileInfo">
      <div class="file-dot">
        <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      </div>
      <div class="file-details">
        <div class="file-name" id="fileName"></div>
        <div class="file-size" id="fileSize"></div>
      </div>
      <button class="file-remove" id="fileRemove" title="Remove">
        <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
  </div>

  <!-- Target format -->
  <div class="card">
    <div class="card-label">Target format</div>
    <div class="format-grid" id="formatGrid">

      <div class="fmt-btn active" data-format="pmp">
        <div class="fmt-dot" style="background:rgba(153,102,255,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#9966ff" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M6 20v-2a6 6 0 0 1 12 0v2"/></svg>
        </div>
        <div class="fmt-name">PenguinMod</div>
        <div class="fmt-ext">.pmp</div>
      </div>

      <div class="fmt-btn" data-format="snail">
        <div class="fmt-dot" style="background:rgba(255,171,25,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#ffab19" stroke-width="2.5" stroke-linecap="round"><circle cx="10" cy="14" r="5"/><path d="M10 9V6a3 3 0 0 1 6 0v5"/></svg>
        </div>
        <div class="fmt-name">Snail IDE</div>
        <div class="fmt-ext">.snail</div>
      </div>

      <div class="fmt-btn" data-format="bm">
        <div class="fmt-dot" style="background:rgba(255,224,102,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#ffe066" stroke-width="2.5" stroke-linecap="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
        </div>
        <div class="fmt-name">BananaMod</div>
        <div class="fmt-ext">.bm</div>
      </div>

      <div class="fmt-btn" data-format="dino">
        <div class="fmt-dot" style="background:rgba(89,224,154,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#59e09a" stroke-width="2.5" stroke-linecap="round"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        </div>
        <div class="fmt-name">DinosaurMod</div>
        <div class="fmt-ext">.dino</div>
      </div>

      <div class="fmt-btn" data-format="cw">
        <div class="fmt-dot" style="background:rgba(255,157,214,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#ff9dd6" stroke-width="2.5" stroke-linecap="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </div>
        <div class="fmt-name">Cattie's World</div>
        <div class="fmt-ext">.cw</div>
      </div>

      <div class="fmt-btn" data-format="dbp">
        <div class="fmt-dot" style="background:rgba(96,207,255,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#60cfff" stroke-width="2.5" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        </div>
        <div class="fmt-name">DashBlocks</div>
        <div class="fmt-ext">.dbp</div>
      </div>

      <div class="fmt-btn" data-format="electra">
        <div class="fmt-dot" style="background:rgba(167,139,250,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="2.5" stroke-linecap="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        </div>
        <div class="fmt-name">ElectraMod</div>
        <div class="fmt-ext">.electra</div>
      </div>

      <div class="fmt-btn" data-format="coffee">
        <div class="fmt-dot" style="background:rgba(200,164,110,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#c8a46e" stroke-width="2.5" stroke-linecap="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        </div>
        <div class="fmt-name">Espresso</div>
        <div class="fmt-ext">.coffee</div>
      </div>

      <div class="fmt-btn" data-format="falcon">
        <div class="fmt-dot" style="background:rgba(110,231,183,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#6ee7b7" stroke-width="2.5" stroke-linecap="round"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg>
        </div>
        <div class="fmt-name">FalconMod</div>
        <div class="fmt-ext">.falcon</div>
      </div>

      <div class="fmt-btn" data-format="ich">
        <div class="fmt-dot" style="background:rgba(244,114,182,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#f472b6" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        </div>
        <div class="fmt-name">Itch</div>
        <div class="fmt-ext">.ich</div>
      </div>

      <div class="fmt-btn" data-format="zinc">
        <div class="fmt-dot" style="background:rgba(147,197,253,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#93c5fd" stroke-width="2.5" stroke-linecap="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>
        </div>
        <div class="fmt-name">Zinc Coding</div>
        <div class="fmt-ext">.zinc</div>
      </div>

      <div class="fmt-btn" data-format="sb3">
        <div class="fmt-dot" style="background:rgba(77,151,255,0.2);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#4d97ff" stroke-width="2.5" stroke-linecap="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        </div>
        <div class="fmt-name">Scratch</div>
        <div class="fmt-ext">.sb3</div>
      </div>

    </div>
  </div>

  <!-- Convert button -->
  <div class="btn-row">
    <button class="btn-convert" id="btnConvert" disabled>Convert file</button>
    <button class="btn-export-all" id="btnExportAll" disabled>Export All</button>
  </div>
  <div class="same-format-msg" id="sameFormatMsg">
    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    The file is already in this format ‚Äî select a different target
  </div>

  <!-- Progress -->
  <div class="card" id="progressCard" style="display:none;">
    <div class="card-label">Converting</div>
    <div class="prog-label">
      <span id="progressText">Reading file...</span>
      <span id="progressPct">0%</span>
    </div>
    <div class="prog-track"><div class="prog-fill" id="progressFill"></div></div>
    <div class="log-box" id="logBox"></div>
  </div>

  <!-- Result -->
  <div class="card result-card" id="resultCard">
    <div class="result-top">
      <div class="result-check">
        <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <div class="result-info">
        <div class="result-title">Conversion complete</div>
        <div class="result-file" id="resultFile">‚Äî</div>
      </div>
    </div>
    <div class="result-actions">
      <button class="btn-download" id="btnDownload">Download file</button>
      <button class="btn-again" id="btnAgain">Convert another</button>
    </div>
  </div>

</div>

<footer>Everything is processed locally in your browser ‚Äî no data is uploaded to any server</footer>

<script>
  let selectedFile = null;
  let selectedFileExt = null;
  let convertedBlob = null;
  let outputFileName = '';
  let targetFormat = 'pmp';

  const FORMATS = {
    pmp:     { ext:'.pmp',     name:'PenguinMod',    meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'PenguinMod', url:'https://penguinmod.com/', version:'stable' } }, addExtData:true,  addCustomVars:true,  addId:true,  removeExtData:false, removeCustomVars:false },
    snail:   { ext:'.snail',   name:'Snail IDE',      meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'snail-ide',  url:'https://snail-ide.com/',  version:'stable' } }, addExtData:true,  addCustomVars:false, addId:false, removeExtData:false, removeCustomVars:false },
    bm:      { ext:'.bm',      name:'BananaMod',      meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'snail-ide',  url:'https://snail-ide.com/',  version:'stable' } }, addExtData:true,  addCustomVars:false, addId:false, removeExtData:false, removeCustomVars:false },
    dino:    { ext:'.dino',    name:'DinosaurMod',    meta:{ semver:'3.0.0', vm:'0.2.0', origin:'PenguinMod', agent:'', platform:{ name:'PenguinMod', url:'https://penguinmod.com/', version:'stable' } }, addExtData:true, addCustomVars:true, addId:true, removeExtData:false, removeCustomVars:false },
    cw:      { ext:'.cw',      name:"Cattie's World", meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'PenguinMod', url:'https://penguinmod.com/', version:'stable' } }, addExtData:true,  addCustomVars:true,  addId:true,  removeExtData:false, removeCustomVars:false },
    dbp:     { ext:'.dbp',     name:'DashBlocks',     meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'Dash',       url:'https://dashblocks.github.io/'              } }, addExtData:false, addCustomVars:false, addId:false, removeExtData:true,  removeCustomVars:true  },
    electra: { ext:'.electra', name:'ElectraMod',     meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'ElectraMod', url:'https://electramod.vercel.app/', version:'stable' } }, addExtData:true, addCustomVars:true, addId:true, removeExtData:false, removeCustomVars:false },
    coffee:  { ext:'.coffee',  name:'Espresso',       meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'PenguinMod', url:'https://penguinmod.com/', version:'stable' } }, addExtData:true,  addCustomVars:true,  addId:true,  removeExtData:false, removeCustomVars:false },
    falcon:  { ext:'.falcon',  name:'FalconMod',      meta:{ semver:'3.0.0', vm:'0.2.0', agent:'', platform:{ name:'PenguinMod', url:'https://penguinmod.com/', version:'stable' } }, addExtData:true,  addCustomVars:true,  addId:true,  removeExtData:false, removeCustomVars:false },
    ich:     { ext:'.ich',     name:'Itch',           meta:{ semver:'3.0.0', vm:'0.2.0', agent:'' },                                                                                   addExtData:false, addCustomVars:false, addId:false, removeExtData:true,  removeCustomVars:true  },
    zinc:    { ext:'.zinc',    name:'Zinc Coding',    meta:{ semver:'3.0.0', vm:'0.2.0', agent:'' },                                                                                   addExtData:true,  addCustomVars:false, addId:false, removeExtData:false, removeCustomVars:true  },
    sb3:     { ext:'.sb3',     name:'Scratch',        meta:{ semver:'3.0.0', vm:'12.6.4', agent:'' },                                                                                  addExtData:false, addCustomVars:false, addId:false, removeExtData:true,  removeCustomVars:true  },
  };

  const fileInput    = document.getElementById('fileInput');
  const uploadZone   = document.getElementById('uploadZone');
  const fileInfo     = document.getElementById('fileInfo');
  const fileNameEl   = document.getElementById('fileName');
  const fileSizeEl   = document.getElementById('fileSize');
  const fileRemove   = document.getElementById('fileRemove');
  const btnConvert   = document.getElementById('btnConvert');
  const btnExportAll = document.getElementById('btnExportAll');
  const sameFormatMsg= document.getElementById('sameFormatMsg');
  const progressCard = document.getElementById('progressCard');
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  const progressPct  = document.getElementById('progressPct');
  const logBox       = document.getElementById('logBox');
  const resultCard   = document.getElementById('resultCard');
  const resultFile   = document.getElementById('resultFile');
  const btnDownload  = document.getElementById('btnDownload');
  const btnAgain     = document.getElementById('btnAgain');

  document.getElementById('formatGrid').addEventListener('click', e => {
    const btn = e.target.closest('.fmt-btn');
    if (!btn) return;
    document.querySelectorAll('.fmt-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    targetFormat = btn.dataset.format;
    if (selectedFile) updateUI();
  });

  function getFileExt(filename) {
    const match = filename.match(/\.([^.]+)$/);
    return match ? match[1].toLowerCase() : '';
  }

  function isSameFormat() {
    return selectedFileExt === targetFormat;
  }

  function updateUI() {
    const same = isSameFormat();
    sameFormatMsg.classList.toggle('visible', same);
    btnConvert.disabled = !selectedFile || same;
    btnExportAll.disabled = !selectedFile;
    btnConvert.textContent = same ? 'Same format' : `Convert to ${FORMATS[targetFormat].ext}`;
  }

  uploadZone.addEventListener('click', () => fileInput.click());
  uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('drag-over'); });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('drag-over'));
  uploadZone.addEventListener('drop', e => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    const f = e.dataTransfer.files[0];
    if (f && /\.(sb3|pmp|snail|bm|dino|cw|dbp|electra|coffee|falcon|ich|zinc)$/i.test(f.name)) setFile(f);
    else addLog('err', 'Unsupported format');
  });

  fileInput.addEventListener('change', e => { if (e.target.files[0]) setFile(e.target.files[0]); });

  fileRemove.addEventListener('click', e => {
    e.stopPropagation();
    selectedFile = null;
    selectedFileExt = null;
    fileInfo.classList.remove('visible');
    fileInput.value = '';
    btnConvert.disabled = true;
    btnConvert.textContent = 'Convert file';
    btnExportAll.disabled = true;
    sameFormatMsg.classList.remove('visible');
  });

  function setFile(f) {
    selectedFile = f;
    selectedFileExt = getFileExt(f.name);
    fileNameEl.textContent = f.name;
    fileSizeEl.textContent = fmtSize(f.size);
    fileInfo.classList.add('visible');
    resultCard.classList.remove('visible');
    logBox.innerHTML = '';
    progressCard.style.display = 'none';
    updateUI();
  }

  function fmtSize(b) {
    if (b < 1024) return b + ' B';
    if (b < 1024*1024) return (b/1024).toFixed(1) + ' KB';
    return (b/1024/1024).toFixed(2) + ' MB';
  }

  function addLog(type, msg) {
    const t = new Date().toTimeString().slice(0,8);
    const d = document.createElement('div');
    d.className = 'log-line';
    d.innerHTML = `<span class="log-t">[${t}]</span><span class="log-${type}">${msg}</span>`;
    logBox.appendChild(d);
    logBox.scrollTop = logBox.scrollHeight;
  }

  function setProgress(pct, text) {
    progressFill.style.width = pct + '%';
    progressText.textContent = text;
    progressPct.textContent = pct + '%';
  }

  function genId(n=20) {
    const c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
    return Array.from({length:n}, () => c[Math.floor(Math.random()*c.length)]).join('');
  }

  const sleep = ms => new Promise(r => setTimeout(r, ms));

  async function convertProject(project, fmt) {
    const p = JSON.parse(JSON.stringify(project));
    p.meta = { ...fmt.meta };
    if (fmt.addExtData)         { p.extensionData = p.extensionData || {}; }
    else if (fmt.removeExtData) { delete p.extensionData; }
    if (p.targets) {
      for (const t of p.targets) {
        if (fmt.addId && !t.id)                 t.id = genId(20);
        if (fmt.addCustomVars && !t.customVars)  t.customVars = [];
        else if (fmt.removeCustomVars)           delete t.customVars;
        if (fmt.addExtData && !t.extensionData)  t.extensionData = {};
        else if (fmt.removeExtData)              delete t.extensionData;
      }
    }
    return p;
  }

  async function buildZip(originalZip, project) {
    const newZip = new JSZip();
    await Promise.all(
      Object.entries(originalZip.files)
        .filter(([p, e]) => p !== 'project.json' && !e.dir)
        .map(([p, e]) => e.async('uint8array').then(d => newZip.file(p, d)))
    );
    newZip.file('project.json', JSON.stringify(project));
    return newZip.generateAsync({ type:'blob', compression:'DEFLATE', compressionOptions:{level:6} });
  }

  btnConvert.addEventListener('click', async () => {
    if (!selectedFile || isSameFormat()) return;
    btnConvert.disabled = true;
    btnExportAll.disabled = true;
    progressCard.style.display = 'block';
    resultCard.classList.remove('visible');
    logBox.innerHTML = '';
    const fmt = FORMATS[targetFormat];
    try {
      setProgress(10, 'Reading file...');
      addLog('info', `Loading: ${selectedFile.name}`);
      addLog('info', `Target: ${fmt.name} (${fmt.ext})`);
      await sleep(150);
      const zip = await JSZip.loadAsync(await selectedFile.arrayBuffer());
      setProgress(25, 'Parsing project.json...');
      const jsonStr = await zip.file('project.json').async('string');
      const project = JSON.parse(jsonStr);
      addLog('ok', `project.json found (${fmtSize(jsonStr.length)})`);
      addLog('info', `Sprites: ${project.targets?.length || 0}`);
      await sleep(100);
      setProgress(50, 'Applying changes...');
      const converted = await convertProject(project, fmt);
      addLog('ok', `Meta updated ‚Üí ${fmt.name}`);
      for (const t of (project.targets || [])) addLog('ok', `Sprite "${t.name}" updated`);
      await sleep(100);
      setProgress(80, `Building ${fmt.ext}...`);
      convertedBlob = await buildZip(zip, converted);
      setProgress(100, 'Done!');
      addLog('ok', `Created: ${fmtSize(convertedBlob.size)}`);
      await sleep(250);
      outputFileName = selectedFile.name.replace(/\.[^.]+$/, '') + fmt.ext;
      addLog('ok', `Ready: ${outputFileName}`);
      resultFile.textContent = `${outputFileName}  ‚Äî  ${fmtSize(convertedBlob.size)}`;
      setTimeout(() => resultCard.classList.add('visible'), 10);
    } catch (err) {
      addLog('err', 'Error: ' + err.message);
      console.error(err);
    }
    btnConvert.disabled = isSameFormat();
    btnExportAll.disabled = false;
  });

  btnExportAll.addEventListener('click', async () => {
    if (!selectedFile) return;
    btnConvert.disabled = true;
    btnExportAll.disabled = true;
    progressCard.style.display = 'block';
    resultCard.classList.remove('visible');
    logBox.innerHTML = '';
    try {
      setProgress(5, 'Reading file...');
      addLog('info', `Export All: ${selectedFile.name}`);
      await sleep(100);
      const zip = await JSZip.loadAsync(await selectedFile.arrayBuffer());
      const jsonStr = await zip.file('project.json').async('string');
      const project = JSON.parse(jsonStr);
      addLog('ok', `project.json found ‚Äî ${project.targets?.length || 0} sprites`);
      const baseName = selectedFile.name.replace(/\.[^.]+$/, '');
      const outputZip = new JSZip();
      const fmtKeys = Object.keys(FORMATS).filter(k => k !== selectedFileExt);
      const step = 80 / fmtKeys.length;
      for (let i = 0; i < fmtKeys.length; i++) {
        const key = fmtKeys[i];
        const fmt = FORMATS[key];
        setProgress(10 + Math.round(step * i), `Converting to ${fmt.ext}...`);
        addLog('info', `‚Üí ${fmt.name} (${fmt.ext})`);
        const converted = await convertProject(project, fmt);
        const blob = await buildZip(zip, converted);
        const arr = await blob.arrayBuffer();
        outputZip.file(baseName + fmt.ext, arr);
        await sleep(30);
      }
      setProgress(95, 'Packaging ZIP...');
      const finalBlob = await outputZip.generateAsync({ type:'blob', compression:'DEFLATE', compressionOptions:{level:6} });
      setProgress(100, 'Done!');
      addLog('ok', `All formats exported (${fmtSize(finalBlob.size)})`);
      await sleep(250);
      outputFileName = baseName + '_all-formats.zip';
      convertedBlob = finalBlob;
      resultFile.textContent = `${outputFileName}  ‚Äî  ${fmtSize(finalBlob.size)}`;
      setTimeout(() => resultCard.classList.add('visible'), 10);
    } catch (err) {
      addLog('err', 'Error: ' + err.message);
      console.error(err);
    }
    btnConvert.disabled = isSameFormat();
    btnExportAll.disabled = false;
  });

  btnDownload.addEventListener('click', () => {
    if (!convertedBlob) return;
    const a = Object.assign(document.createElement('a'), { href: URL.createObjectURL(convertedBlob), download: outputFileName });
    a.click();
    URL.revokeObjectURL(a.href);
  });

  btnAgain.addEventListener('click', () => {
    selectedFile = convertedBlob = null;
    selectedFileExt = null;
    fileInfo.classList.remove('visible');
    fileInput.value = '';
    btnConvert.disabled = true;
    btnConvert.textContent = 'Convert file';
    btnExportAll.disabled = true;
    sameFormatMsg.classList.remove('visible');
    progressCard.style.display = 'none';
    resultCard.classList.remove('visible');
    logBox.innerHTML = '';
  });
</script>
</body>
</html>